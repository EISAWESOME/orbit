'use strict';ob.directive('orbitview',['Images',function(Images){return{restrict:'E',transclude:!0,templateUrl:'views/view.html',controller:function($scope){this.addTooltip=function(tooltip){$scope.tooltips.push(tooltip)};this.addDescription=function(description){$scope.description=description}},link:function($scope,$elem,$attr){Images.loadxml().then(function(dataXML){if(window.DOMParser){let parser=new DOMParser();var xml=parser.parseFromString(dataXML.data,"text/xml")}else{var xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(dataXML)}
  let imgData=xml.getElementsByTagName('img');let scaleData=xml.getElementsByTagName('scale');Images.level=[];Images.ext=imgData[0].getAttribute('ext');for(let i=0;i<scaleData.length;i++){if(Number(scaleData[i].getAttribute('width'))>200){Images.level.push({value:Number(scaleData[i].getAttribute('value').replace('.','')),width:Number(scaleData[i].getAttribute('width')),height:Number(scaleData[i].getAttribute('height')),cols:Number(scaleData[i].getAttribute('cols')),rows:Number(scaleData[i].getAttribute('rows')),tileHeight:Number(scaleData[i].getAttribute('tile_height')),tileWidth:Number(scaleData[i].getAttribute('tile_width')),resources:[]});for(let j=0;j<imgData.length;j++){Images.level[i].resources.push([]);for(let k=0;k<Images.level[i].cols*Images.level[i].rows;k++){let name=Images.url()+'images/'+imgData[j].getAttribute('name')+'_'+Images.level[i].value+'_'+Math.floor(k/Images.level[i].rows)+'_'+k%Images.level[i].rows+'.'+Images.ext;Images.level[i].resources[j].push({'loaded':!1,'img':name})}}}}
  Images.nbAngle=Images.level[0].resources.length;$scope.init()})}}}])
