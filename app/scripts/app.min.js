'use strict';var ob=angular.module('Orbit',['ngMaterial','ngResource','ngAnimate','hmGestures','mousewheel','ui.bootstrap']);ob.config(function($mdThemingProvider){$mdThemingProvider.theme('grey').primaryPalette('grey')}).controller('OrbitCtrl',['$scope','$rootScope','Images','$mdDialog','$mdToast','$mdSidenav',function($scope,$rootScope,Images,$mdDialog,$mdToast,$mdSidenav){$rootScope.$on('onLoading',function(event,percent){$scope.loading=percent});$rootScope.$on('onComplete',function(){let time=new Date();$scope.loading=!1});$scope.init=function(){$scope.canvas=document.getElementById('orbit-canvas');$scope.renderer=$scope.canvas.getContext('2d');$scope.level=Images.level.length-1;Images.loadLevel($scope.level);window.onresize=$scope.resize;$scope.resize();$scope.visible=!0;setInterval(function(){$scope.loadingReso=$scope.waitingload;$scope.draw()},40);Images.loadLevel($scope.level);Images.loadxml().then(function(dataXML){if(window.DOMParser){let tmp=new DOMParser();$scope.xml=tmp.parseFromString(dataXML.data,"text/xml")}
else{$scope.xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(dataXML)}
  if($scope.xml.getElementsByTagName('property').length>0){let colProperties=$scope.xml.getElementsByTagName('property');for(let i=0;i<colProperties.length;i++){if(colProperties[i].getAttribute('name')==='titre'){$scope.titre=colProperties[i].textContent}
    if(colProperties[i].getAttribute('name')==='description'){$scope.description=colProperties[i].textContent}}}else{Images.loadDetails().then(function(dataXML){if(window.DOMParser){let tmp=new DOMParser();$scope.details=tmp.parseFromString(dataXML.data,"text/xml")}
  else{$scope.details=new ActiveXObject("Microsoft.XMLDOM");details.async="false";details.loadXML(dataXML)}
    let colProperties=$scope.details.getElementsByTagName('property');for(let i=0;i<colProperties.length;i++){if(colProperties[i].getAttribute('name')==='titre'&&!$scope.titre){$scope.titre=colProperties[i].textContent}
      if(colProperties[i].getAttribute('name')==='description'&&!$scope.description){$scope.description=colProperties[i].textContent}}})}
  let colPoints=$scope.xml.getElementsByTagName('PointInteret');for(let i=0;i<colPoints.length;i++){let titre=colPoints[i].getElementsByTagName('Titre');let desc=colPoints[i].getElementsByTagName('Description');let angle=colPoints[i].attributes[0].value;let id=colPoints[i].attributes[1].value;let coord={x:colPoints[i].getElementsByTagName('Coord')[0].getAttribute('x'),y:colPoints[i].getElementsByTagName('Coord')[0].getAttribute('y')};let tooltip={title:titre[0].textContent,desc:desc[0].textContent,image:angle,x:coord.x,y:coord.y,id:id};$scope.id++;for(let i=0,len=$scope.tooltips.length;i<len;i++){$scope.lookupAngle[$scope.tooltips[i].image]=$scope.tooltips[i]}
    $scope.tooltips.push(tooltip)}
  if($scope.lookupAngle[$scope.angle]){displayDesc()}
  document.querySelector("#descImage").addEventListener("paste",function(e){setTimeout(function()
  {let body=document.querySelector('#descImage');let regex=/(&nbsp;|<([^>]+)>)/ig;body.innerHTML=body.innerHTML.replace(regex,"")},0)})});$scope.modeCursor()};$scope.id=0;$scope.lookupAngle={};$scope.translaY=0;$scope.translaX=0;$scope.prevDeltaX=0;$scope.prevDeltaY=0;$scope.pinIcon=new Image();$scope.pinIcon.src='../app/images/pinIcon-32x32.png';$scope.theme='grey';$scope.clickRotation=!0;$scope.clickTranslation=!1;$scope.pinMode=!1;$scope.autoPlay=!1;$scope.isEditMode=!1;$scope.isFullscreen=!1;$scope.fsSrc="./images/icon_fullscreen.png";$scope.currentCursor='default';$scope.tooltips=[];$scope.tooltip=null;$scope.tooltipTrueCoord={};$scope.tooltipTitre="";$scope.tooltipDesc="";$scope.isPopDrawn=!1;$scope.loading='0';$scope.loadingReso=!1;$scope.waitingload=!0;$scope.visible=!1;$scope.zoom=1;$scope.level=0;$scope.angle=0;$scope.posX=0;$scope.posY=0;$scope.actualTileWidth=0;$scope.actualTileHeight=0;$scope.isNavCollapsed=!0;$scope.isCollapsed=!0;$scope.isTitreCollapsed=!0;$scope.draw=function(){if(($scope.waitingload&&Images.resourcesLoaded($scope.level,$scope.angle))||$scope.edited){$scope.waitingload=!1;$scope.canvas.width=$scope.canvas.width;$scope.renderer.translate($scope.translaX,$scope.translaY);$scope.renderer.save();let lvl=$scope.level;let current=Images.level[lvl].resources[$scope.angle];if(!Images.resourcesLoaded(lvl,$scope.angle)){$scope.waitingload=!0;Images.loadResources(lvl,$scope.angle);while(lvl<Images.level.length-1&&!Images.resourcesLoaded(lvl,$scope.angle)){lvl++}
  current=Images.level[lvl].resources[$scope.angle]}
  let ILvl=Images.level[lvl],posOriX=$scope.getX(),posOriY=$scope.getY(),lapX=Math.floor(Images.level[0].width/ILvl.cols)*$scope.zoom,lapY=Math.floor(Images.level[0].height/ILvl.rows)*$scope.zoom;for(let i=0;i<current.length;i++){$scope.posX=posOriX+lapX*Math.floor(i/ILvl.rows);$scope.posY=posOriY+lapY*Math.floor(i%ILvl.rows);$scope.actualTileWidth=current[i].img.naturalWidth*$scope.zoom*1000/ILvl.value+1;$scope.actualTileHeight=current[i].img.naturalHeight*$scope.zoom*1000/ILvl.value+1;$scope.renderer.drawImage(current[i].img,$scope.posX,$scope.posY,$scope.actualTileWidth,$scope.actualTileHeight)}
  let points=$scope.xml.getElementsByTagName('PointInteret');for(let j=0;j<points.length;j++){if(points[j].getAttribute('Angle')==$scope.angle){let
    pinCoord=points[j].getElementsByTagName('Coord'),pinX=Number(pinCoord[0].getAttribute('x')),pinY=Number(pinCoord[0].getAttribute('y'));let drawX=pinX*$scope.zoom,drawY=pinY*$scope.zoom;let centerX=($scope.canvas.clientWidth/2+drawX);let centerY=($scope.canvas.clientHeight/2+drawY);$scope.renderer.drawImage($scope.pinIcon,centerX-16,centerY-32)}}
  $scope.edited=!1}};$scope.getX=function(){return+(($scope.canvas.width/2)-((Images.level[0].width/2)*$scope.zoom)).toFixed(0)};$scope.getY=function(){return-(((Images.level[0].height*$scope.zoom)-$scope.canvas.height)/2).toFixed(0)};$scope.resize=function(){$scope.resetTransla();$scope.renderer.restore();$scope.canvas.width=$scope.canvas.offsetWidth;$scope.canvas.height=$scope.canvas.offsetHeight;if($scope.loading===!0){return!1}
  if($scope.canvas.width/Images.level[0].width<=$scope.canvas.height/Images.level[0].height){$scope.zoom=$scope.canvas.width/Images.level[0].width}else{$scope.zoom=$scope.canvas.height/Images.level[0].height}
  $scope.level=Images.level.length-1;while($scope.zoom*1000>Images.level[$scope.level].value){$scope.level--}
  $scope.minZoom=$scope.zoom;$scope.maxZoom=1;if($scope.visible){$scope.$apply()}
  $scope.edited=!0};$scope.toggleGrab=function(){if(!$scope.pinMode){if($scope.canvas.style.cursor=="-webkit-grab"||$scope.canvas.style.cursor=="-moz-grab"||$scope.canvas.style.cursor=="grab"){$scope.canvas.style.cursor="-webkit-grabbing";$scope.canvas.style.cursor="-moz-grabbing";$scope.canvas.style.cursor="grabbing"}else{$scope.canvas.style.cursor="-webkit-grab";$scope.canvas.style.cursor="-moz-grab";$scope.canvas.style.cursor="grab"}}};$scope.dragStart=function(){if($scope.clickRotation&&!$scope.clickTranslation){$scope.toggleGrab()}};$scope.drag=function(e){if($scope.clickRotation&&!$scope.clickTranslation){let dst=$scope.lastDrag-e.gesture.deltaX,ratio;dst*=1;ratio=dst/10;ratio=ratio.toFixed(0);if(ratio==='-0'){ratio=-1}else if(ratio==='0'){ratio=1}
  $scope.lastDrag=e.gesture.deltaX;$scope.setAngle($scope.angle+parseInt(ratio))}
  if($scope.clickTranslation&&!$scope.clickRotation){let
    deplacementX=e.gesture.deltaX-$scope.prevDeltaX,deplacementY=e.gesture.deltaY-$scope.prevDeltaY;$scope.incrTranslaX(deplacementX);$scope.incrTranslaY(deplacementY);$scope.prevDeltaX=e.gesture.deltaX;$scope.prevDeltaY=e.gesture.deltaY;$scope.edited=!0}};$scope.dragEnd=function(){if($scope.clickRotation&&!$scope.clickTranslation){$scope.toggleGrab()}
  $scope.prevDeltaX=0;$scope.prevDeltaY=0};$scope.goTo=function(angle){if($scope.angle!=angle){if(Images.nbAngle-angle+$scope.origAngle<angle-$scope.origAngle){$scope.setAngle($scope.angle-1)}else $scope.setAngle($scope.angle+1);window.setTimeout($scope.goTo,5,angle)}else{if(document.querySelector('.titrePop'))
  document.querySelector('.titrePop').style.display='block'}};$scope.keymove=function(e){if($scope.isNavCollapsed){if($scope.clickRotation&&!$scope.clickTranslation){if(e.keyCode===39)
  $scope.setAngle($scope.angle-1);if(e.keyCode===37)
  $scope.setAngle($scope.angle+1)}
  if($scope.clickTranslation&&!$scope.clickRotation){$scope.renderer.restore();$scope.renderer.save();if(e.keyCode===37)
    $scope.incrTranslaX(-10);if(e.keyCode===38)
    $scope.incrTranslaY(-10);if(e.keyCode===39)
    $scope.incrTranslaX(10);if(e.keyCode===40)
    $scope.incrTranslaY(10);$scope.edited=!0}}};$scope.incrTranslaX=function(translaX){$scope.translaX+=translaX};$scope.incrTranslaY=function(translaY){$scope.translaY+=translaY};$scope.setAngle=function(angle){if(angle>=Images.nbAngle)$scope.angle=angle-Images.nbAngle;else if(angle<0)$scope.angle=angle+Images.nbAngle;else $scope.angle=angle;if($scope.lookupAngle[$scope.angle]){displayDesc()}
  $scope.edited=!0};$scope.setTranslaXY=function(translaX,translaY){$scope.translaX=translaX;$scope.translaY=translaY;$scope.edited=!0};$scope.resetTransla=function(){$scope.translaY=0;$scope.translaX=0;$scope.edited=!0};$scope.play=function(){if($scope.autoPlay){$scope.setAngle($scope.angle+1);window.setTimeout($scope.play,40)}};$scope.toggleFullscreen=function(){let elem=document.querySelector("html");if($scope.isFullscreen){$scope.fsSrc="./images/icon_fullscreen_back.png";if(elem.requestFullscreen){elem.requestFullscreen()}else if(elem.msRequestFullscreen){elem.msRequestFullscreen()}else if(elem.mozRequestFullScreen){elem.mozRequestFullScreen()}else if(elem.webkitRequestFullscreen){elem.webkitRequestFullscreen()}}
else{$scope.fsSrc="./images/icon_fullscreen.png";if(document.exitFullscreen){document.exitFullscreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}}};$scope.onWheel=function(e){$scope.renderer.restore();let zoom=$scope.zoom;if(e.deltaY>0){$scope.zoomOut()}else{$scope.zoomIn()}
  if(zoom!=$scope.zoom)$scope.edited=!0};$scope.zoomOut=function(){$scope.zoom-=0.1;if($scope.zoom<$scope.minZoom){$scope.zoom=$scope.minZoom}
  if($scope.level<Images.level.length-1&&$scope.zoom*1000<=Images.level[$scope.level+1].value)
    $scope.level++;$scope.edited=!0};$scope.zoomIn=function(){$scope.zoom+=0.1;if($scope.zoom>=$scope.maxZoom){$scope.zoom=$scope.maxZoom}
  if($scope.level>0&&$scope.zoom*1000>Images.level[$scope.level].value)
    $scope.level--;$scope.edited=!0};$scope.editMode=function(){$scope.isEditMode=!$scope.isEditMode;if($scope.isEditMode===!1){$scope.pinMode=!1}};$scope.modeCursor=function(){if($scope.pinMode){$scope.canvas.style.cursor="crosshair";$scope.currentCursor="crosshair"}else{if($scope.clickRotation&&!$scope.clickTranslation){$scope.canvas.style.cursor="-webkit-grab";$scope.canvas.style.cursor="-moz-grab";$scope.canvas.style.cursor="grab";$scope.currentCursor="grab"}
  if($scope.clickTranslation&&!$scope.clickRotation)
    $scope.canvas.style.cursor="move";$scope.currentCursor="move"}}
  $scope.switchMode=function(){$scope.clickRotation=!$scope.clickRotation;$scope.clickTranslation=!$scope.clickTranslation;$scope.modeCursor()};function detectIE(){let ua=window.navigator.userAgent;let msie=ua.indexOf('MSIE ');if(msie>0){return parseInt(ua.substring(msie+5,ua.indexOf('.',msie)),10)}
    let trident=ua.indexOf('Trident/');if(trident>0){let rv=ua.indexOf('rv:');return parseInt(ua.substring(rv+3,ua.indexOf('.',rv)),10)}
    let edge=ua.indexOf('Edge/');if(edge>0){return parseInt(ua.substring(edge+5,ua.indexOf('.',edge)),10)}
    return!1}
  $scope.exportXML=function(){let properties=$scope.xml.createElement('properties'),propTitre=$scope.xml.createElement('property'),propDesc=propTitre.cloneNode(!0);propTitre.setAttribute('name','titre');propDesc.setAttribute('name','description');let htmldataTitre=document.querySelector('#titreImage').innerHTML,htmldataDesc=document.querySelector('#descImage').innerHTML;let cdataTitre=$scope.xml.createCDATASection(htmldataTitre),cdataDesc=$scope.xml.createCDATASection(htmldataDesc);propTitre.appendChild(cdataTitre);propDesc.appendChild(cdataDesc);properties.appendChild(propTitre);properties.appendChild(propDesc);$scope.xml.getElementsByTagName('sequence')[0].appendChild(properties);let content=(new XMLSerializer().serializeToString($scope.xml));if(content){if(detectIE()){let popup=window.open();popup.document.write("<textarea style='width: 100%; height: 100%; border:none;'>"+content+"</textarea>")}
  else{window.open('data:text/xml,'+encodeURIComponent(content),"Test","width=900,height=900,scrollbars=1,resizable=1")}}};$scope.pin=function(e){if($scope.pinMode){if(!$scope.isNavCollapsed)
    $scope.toggleLeft();let lvl=$scope.level;let cursorX=(e.gesture.center.pageX-$scope.canvas.clientWidth/2)-$scope.translaX,cursorY=(e.gesture.center.pageY-$scope.canvas.clientHeight/2)-$scope.translaY;let ratioX=Images.level[0].width/($scope.actualTileWidth*Images.level[lvl].cols),ratioY=Images.level[0].height/($scope.actualTileHeight*Images.level[lvl].rows);$scope.tooltipTrueCoord={x:cursorX*ratioX,y:cursorY*ratioY};if(!(cursorX>$scope.actualTileWidth*Images.level[lvl].cols/2||cursorX<-$scope.actualTileWidth*Images.level[lvl].cols/2||cursorY>$scope.actualTileHeight*Images.level[lvl].rows/2||cursorY<-$scope.actualTileHeight*Images.level[lvl].rows/2)){$scope.promptPoint()}}};$scope.createTooltip=function(){let id=$scope.id;$scope.id++;let title=$scope.tooltipTitre;let desc=$scope.tooltipDesc;$scope.writePin(title,desc,$scope.angle,$scope.tooltipTrueCoord,id);let tooltip={title:title,desc:desc,image:$scope.angle,x:$scope.tooltipTrueCoord.x,y:$scope.tooltipTrueCoord.y,id:id};$scope.tooltips.push(tooltip);for(let i=0,len=$scope.tooltips.length;i<len;i++){$scope.lookupAngle[$scope.tooltips[i].image]=$scope.tooltips[i]}
    if($scope.lookupAngle[$scope.angle]){displayDesc()}
    $scope.edited=!0};$scope.writePin=function(titre,desc,angle,coord,id){let elmPoint=$scope.xml.createElement('PointInteret'),elmTitre=$scope.xml.createElement('Titre'),elmDesc=$scope.xml.createElement('Description'),elmCoord=$scope.xml.createElement('Coord'),cdataDesc=$scope.xml.createCDATASection(desc),cdataTitre=$scope.xml.createCDATASection(titre);elmPoint.setAttribute('Angle',angle);elmPoint.setAttribute('ID',id);elmCoord.setAttribute('x',coord.x);elmCoord.setAttribute('y',coord.y);elmTitre.appendChild(cdataTitre);elmDesc.appendChild(cdataDesc);elmPoint.appendChild(elmTitre);elmPoint.appendChild(elmDesc);elmPoint.appendChild(elmCoord);$scope.xml.getElementsByTagName('sequence')[0].appendChild(elmPoint)};$scope.deletePoint=function(e){let lookup={};for(let i=0,len=$scope.tooltips.length;i<len;i++){lookup[$scope.tooltips[i].id]=$scope.tooltips[i]}
    let ttId=e.target.parentNode.parentNode.parentNode.id;$scope.tooltip=lookup[ttId];$scope.tooltip.id=ttId;let a=e.target;let els=[];while(a){els.unshift(a);a=a.parentNode}
    els[7].remove();let indextt=$scope.tooltips.indexOf($scope.tooltip);$scope.tooltips.splice(indextt,1);for(let i=0,len=$scope.tooltips.length;i<len;i++){$scope.lookupAngle[$scope.tooltips[i].image]=$scope.tooltips[i]}
    let points=$scope.xml.getElementsByTagName('PointInteret');for(let i=0;i<points.length;i++){if(points[i].getAttribute('Angle')==$scope.tooltip.image&&points[i].getElementsByTagName('Titre')[0].textContent==$scope.tooltip.title){let coord=points[i].getElementsByTagName('Coord')[0];if(coord.getAttribute('x')==$scope.tooltip.x&&coord.getAttribute('y')==$scope.tooltip.y){points[i].parentNode.removeChild(points[i]);$scope.showSimpleToast()}}}
    $scope.edited=!0};$scope.toggleEditTooltip=function(e){let lookup={};for(let i=0,len=$scope.tooltips.length;i<len;i++){lookup[$scope.tooltips[i].id]=$scope.tooltips[i]}
    let ttId=e.target.parentNode.parentNode.parentNode.id;$scope.tooltip=lookup[ttId];$scope.tooltip.id=ttId;let ligneTitre=e.target.parentNode.parentNode.parentNode.childNodes[1];let tdTitre=ligneTitre.childNodes[3];let ligneDesc=e.target.parentNode.parentNode.parentNode.childNodes[3];let divDesc=ligneDesc.childNodes[1].childNodes[1].childNodes[1];if(tdTitre.contentEditable=="true"){tdTitre.setAttribute("contenteditable","false");updateTooltip(ttId,"titre","",tdTitre.textContent)}else tdTitre.setAttribute("contenteditable","true");if(divDesc.contentEditable=="true"){divDesc.setAttribute("contenteditable","false");updateTooltip(ttId,"desc",divDesc.textContent,"")}else divDesc.setAttribute("contenteditable","true")};function getPIByID(colPI,id){for(let i=0;i<colPI.length;i++){if(colPI[i].getAttribute('ID')==id){return i}}}
  function updateTooltip(id,champ,valeurDesc,valeurTitre){let colPI=$scope.xml.getElementsByTagName("PointInteret");let id2=getPIByID(colPI,id)
    let currentTooltip=colPI[id2];let titreNode=currentTooltip.getElementsByTagName("Titre");let descNode=currentTooltip.getElementsByTagName("Description");if(champ=="desc"){$scope.tooltip.desc=valeurDesc;currentTooltip.removeChild(descNode[0]);let newDesc=$scope.xml.createElement('Description');let cdataDesc=$scope.xml.createCDATASection(valeurDesc);newDesc.appendChild(cdataDesc);$scope.xml.getElementsByTagName("PointInteret")[id2].appendChild(newDesc)}
    if(champ=="titre"){$scope.tooltip.title=valeurTitre;currentTooltip.removeChild(titreNode[0]);let newTitre=$scope.xml.createElement('Titre');let cdataTitre=$scope.xml.createCDATASection(valeurTitre);newTitre.appendChild(cdataTitre);$scope.xml.getElementsByTagName("PointInteret")[id2].appendChild(newTitre)}}
  $scope.pointPop=function(mode,popContent,pointX,pointY){if(!$scope.isPopDrawn){let
    popContainer=document.createElement("div"),popText=document.createTextNode(popContent);let a=document.querySelector('orbitview');popContainer.appendChild(popText);popContainer.style.marginLeft=pointX+"px";popContainer.style.marginTop=pointY+"px";popContainer.className=mode+"Pop";a.appendChild(popContainer);$scope.isPopDrawn=!0}};$scope.deleteAllPop=function(){let a=document.querySelector('orbitview');let b=document.querySelector('.titrePop');let c=document.querySelector('.descPop');if(b){a.removeChild(b)}
    if(c){a.removeChild(c)}
    $scope.isPopDrawn=!1};$scope.deleteTitrePop=function(){let a=document.querySelector('orbitview');let b=document.querySelector('.titrePop');if(b){a.removeChild(b)}};function displayDesc(){let matchedTt=$scope.tooltips.filter(matchAngle);function matchAngle(element){return element.image==$scope.angle}
    $scope.canvas.addEventListener('mousemove',function(e){let lvl=$scope.level;let aX=(e.pageX-$scope.canvas.clientWidth/2)-$scope.translaX,aY=(e.pageY-$scope.canvas.clientHeight/2)-$scope.translaY;let ratioX=Images.level[0].width/($scope.actualTileWidth*Images.level[lvl].cols),ratioY=Images.level[0].height/($scope.actualTileHeight*Images.level[lvl].rows);let cursorX=aX*ratioX,cursorY=aY*ratioY;let incr=0;for(let i=0;i<matchedTt.length;i++){let
      pointX=((matchedTt[i].x/ratioX)+$scope.translaX)+$scope.canvas.clientWidth/2,pointY=((matchedTt[i].y/ratioY)+$scope.translaY)+$scope.canvas.clientHeight/2;if(matchedTt[i].image==$scope.angle)
    {if(cursorX>=Number(matchedTt[i].x)-(10/$scope.zoom)&&cursorX<=Number(matchedTt[i].x)+(10/$scope.zoom)){if(cursorY>=Number(matchedTt[i].y)-(40/$scope.zoom)&&cursorY<=Number(matchedTt[i].y)+(10/$scope.zoom)){$scope.deleteTitrePop()
      $scope.pointPop('desc',matchedTt[i].desc,pointX,pointY);$scope.canvas.style.cursor='default'}else{incr++}}else{incr++}
      if(incr===matchedTt.length){let a=document.querySelector('orbitview');let b=a.querySelector('.descPop');if(b){a.removeChild(b);$scope.canvas.style.cursor=$scope.currentCursor}
        $scope.isPopDrawn=!1}}}})}
  $scope.clickTooltip=function(e){$scope.deleteAllPop();let lookup={};for(let i=0,len=$scope.tooltips.length;i<len;i++){lookup[$scope.tooltips[i].id]=$scope.tooltips[i]}
    let ttId=e.target.parentNode.parentNode.id;$scope.tooltip=lookup[ttId];$scope.tooltip.id=ttId;$scope.autoPlay=!1;let ratioX=Images.level[0].width/($scope.actualTileWidth*Images.level[$scope.level].cols),ratioY=Images.level[0].height/($scope.actualTileHeight*Images.level[$scope.level].rows);let pointX=(($scope.tooltip.x/ratioX)+$scope.translaX)+$scope.canvas.clientWidth/2,pointY=(($scope.tooltip.y/ratioY)+$scope.translaY)+$scope.canvas.clientHeight/2;$scope.pointPop('titre',$scope.tooltip.title,pointX,pointY);$scope.origAngle=$scope.angle;$scope.goTo($scope.tooltip.image)};$scope.hoverTooltip=function(e){let lookup={};for(let i=0,len=$scope.tooltips.length;i<len;i++){lookup[$scope.tooltips[i].id]=$scope.tooltips[i]}
    let ttId=e.target.parentNode.parentNode.id;$scope.tooltip=lookup[ttId];$scope.tooltip.id=ttId;$scope.autoPlay=!1;if($scope.tooltip.image==$scope.angle){$scope.deleteAllPop();let ratioX=Images.level[0].width/($scope.actualTileWidth*Images.level[$scope.level].cols),ratioY=Images.level[0].height/($scope.actualTileHeight*Images.level[$scope.level].rows);let pointX=(($scope.tooltip.x/ratioX)+$scope.translaX)+$scope.canvas.clientWidth/2,pointY=(($scope.tooltip.y/ratioY)+$scope.translaY)+$scope.canvas.clientHeight/2;$scope.pointPop('titre',$scope.tooltip.title,pointX,pointY);if(document.querySelector('.titrePop'))
      document.querySelector('.titrePop').style.display='block'}};$scope.toggleLeft=buildToggler('left');$scope.toggleRight=buildToggler('right');function buildToggler(componentId){return function(){$mdSidenav(componentId).toggle();$scope.isNavCollapsed=!$scope.isNavCollapsed}}
  $scope.confirmDelete=function(ev,id){let confirm=$mdDialog.confirm().theme('grey').title('Supprimer ce point d\'interet ?').textContent('Vous ne pourrez pas revenir en arrière...').ariaLabel('Suppression').targetEvent(ev).ok('Supprimer').cancel('Annuler');$mdDialog.show(confirm).then(function(){$scope.deletePoint(ev,id)})};$scope.promptPoint=function(ev){$mdDialog.show({templateUrl:'views/tooltipPrompt.tpl.html',parent:angular.element(document.body),targetEvent:ev,controller:'OrbitCtrl',clickOutsideToClose:!0,escapeToClose:!0,}).then(function(answer){$scope.tooltipTitre=answer.Titre;$scope.tooltipDesc=answer.Desc;$scope.createTooltip()})};$scope.envoyer=function(answer){$mdDialog.hide(answer)};$scope.closeDialog=function(){$mdDialog.cancel()};$scope.showSimpleToast=function(){let pinTo='top right';$mdToast.show($mdToast.simple().textContent('Point d\'interet supprimé !').position(pinTo).hideDelay(3000))}}])
