'use strict';ob.factory('Images',['$resource','$location','$rootScope','$http',function(e,t,l,o){return{url:function(){return t.search().model?'../'+t.search().model+'/':'../amonite/'},loadingQueue:[],loadSlot:0,loaded:0,firstLevelLoaded:0,loadxml:function(){return o.get(this.url()+'content.xml')},loadDetails:function(){return o.get(this.url()+'content2.xml')},loadLevel:function(e){let t=new Date,l=this.level[e],o=!1;for(let t=0;t<l.resources.length;t++)this.loadResources(e,t,o)},loadResources:function(e,t,l){if(l=void 0===l||l)for(let l=0;l<this.level[e].resources[t].length;l++)this.loadingQueue.unshift([e,t,l]);else for(let l=0;l<this.level[e].resources[t].length;l++)this.loadingQueue.push([e,t,l]);this.loadQueuedImages()},resourcesLoaded:function(e,t){let l=this.level[e].resources[t];for(let e=0;e<l.length;e++)if(!l[e].loaded)return!1;return!0},loadImage:function(e,t,l,n){n=n||!1;let s=this.level[e].resources[t][l],i=this.level[e].resources[t][l].img;if('string'!=typeof i)return n&&this.loadQueuedImages(),!0;{let r=this,u=new Image;return u.src=i,r.level[e].resources[t][l].img=u,r.loadSlot++,o.get(i,{method:'GET'}).then(function(){s.loaded=!0,r.loadSlot--,n&&r.loadQueuedImages(),r.firstLevelLoaded<r.nbAngle&&e==r.level.length-1&&(r.firstLevelLoaded++,r.loading(r.firstLevelLoaded,r.nbAngle))}),!1}},loadQueuedImages:function(){if(this.loadSlot<3&&this.loadingQueue.length>0){let e=this.loadingQueue.shift();this.loadImage(e[0],e[1],e[2],!0)}},loading:function(e,t){let o=100*e/t;(o=o.toFixed(1))>=100?l.$emit('onComplete'):l.$emit('onLoading',o)}}}]);