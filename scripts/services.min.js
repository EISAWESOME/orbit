(function(){ob.factory("Images",["$resource","$location","$rootScope","$http",function(l,g,f,h){return{url:function(){return g.search().model?"../"+g.search().model+"/":"../amonite/"},loadingQueue:[],loadSlot:0,loaded:0,firstLevelLoaded:0,loadxml:function(){return h.get(this.url()+"content.xml")},loadDetails:function(){return h.get(this.url()+"content2.xml")},loadLevel:function(b){for(var c=this.level[b],a=0;a<c.resources.length;a++)this.loadResources(b,a,!1)},loadResources:function(b,c,a){if("undefined"!==
typeof a?a:1)for(a=0;a<this.level[b].resources[c].length;a++)this.loadingQueue.unshift([b,c,a]);else for(a=0;a<this.level[b].resources[c].length;a++)this.loadingQueue.push([b,c,a]);this.loadQueuedImages()},resourcesLoaded:function(b,c){for(var a=this.level[b].resources[c],e=0;e<a.length;e++)if(!a[e].loaded)return!1;return!0},loadImage:function(b,c,a,e){e=e||!1;var g=this.level[b].resources[c][a],k=this.level[b].resources[c][a].img;if("string"!==typeof k)return e&&this.loadQueuedImages(),!0;var d=
this,f=new Image;f.src=k;d.level[b].resources[c][a].img=f;d.loadSlot++;h.get(k,{method:"GET"}).then(function(){g.loaded=!0;d.loadSlot--;e&&d.loadQueuedImages();d.firstLevelLoaded<d.nbAngle&&b==d.level.length-1&&(d.firstLevelLoaded++,d.loading(d.firstLevelLoaded,d.nbAngle))});return!1},loadQueuedImages:function(){if(3>this.loadSlot&&0<this.loadingQueue.length){var b=this.loadingQueue.shift();this.loadImage(b[0],b[1],b[2],!0)}},loading:function(b,c){var a;a=(100*b/c).toFixed(1);100<=a?f.$emit("onComplete"):
f.$emit("onLoading",a)}}}])})();
